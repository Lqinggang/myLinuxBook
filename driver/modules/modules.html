<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux 设备驱动相关组件 | Linux 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Linux 学习笔记">
    
    <link rel="preload" href="/mylinuxbook/assets/css/0.styles.47dc1b2a.css" as="style"><link rel="preload" href="/mylinuxbook/assets/js/app.4ad5f28c.js" as="script"><link rel="preload" href="/mylinuxbook/assets/js/7.c4013074.js" as="script"><link rel="preload" href="/mylinuxbook/assets/js/2.da4ee029.js" as="script"><link rel="preload" href="/mylinuxbook/assets/js/1.8f7de685.js" as="script"><link rel="preload" href="/mylinuxbook/assets/js/51.6a62369f.js" as="script"><link rel="prefetch" href="/mylinuxbook/assets/js/10.2a392a75.js"><link rel="prefetch" href="/mylinuxbook/assets/js/11.c06597a0.js"><link rel="prefetch" href="/mylinuxbook/assets/js/14.abfc81a7.js"><link rel="prefetch" href="/mylinuxbook/assets/js/15.8e04b7be.js"><link rel="prefetch" href="/mylinuxbook/assets/js/16.caf936ae.js"><link rel="prefetch" href="/mylinuxbook/assets/js/17.c375f3a8.js"><link rel="prefetch" href="/mylinuxbook/assets/js/18.8903301e.js"><link rel="prefetch" href="/mylinuxbook/assets/js/19.7ce306d8.js"><link rel="prefetch" href="/mylinuxbook/assets/js/20.5cd38348.js"><link rel="prefetch" href="/mylinuxbook/assets/js/21.2166e19b.js"><link rel="prefetch" href="/mylinuxbook/assets/js/22.8e2d2de4.js"><link rel="prefetch" href="/mylinuxbook/assets/js/23.02b6bf6e.js"><link rel="prefetch" href="/mylinuxbook/assets/js/24.b60c762f.js"><link rel="prefetch" href="/mylinuxbook/assets/js/25.9248acd9.js"><link rel="prefetch" href="/mylinuxbook/assets/js/26.78d25e49.js"><link rel="prefetch" href="/mylinuxbook/assets/js/27.3b523aff.js"><link rel="prefetch" href="/mylinuxbook/assets/js/28.3dc2c5d6.js"><link rel="prefetch" href="/mylinuxbook/assets/js/29.260e7456.js"><link rel="prefetch" href="/mylinuxbook/assets/js/3.77e74f7f.js"><link rel="prefetch" href="/mylinuxbook/assets/js/30.d8cf5cbe.js"><link rel="prefetch" href="/mylinuxbook/assets/js/31.aa735092.js"><link rel="prefetch" href="/mylinuxbook/assets/js/32.4e3e63fe.js"><link rel="prefetch" href="/mylinuxbook/assets/js/33.c253453f.js"><link rel="prefetch" href="/mylinuxbook/assets/js/34.6f66487f.js"><link rel="prefetch" href="/mylinuxbook/assets/js/35.50343bd1.js"><link rel="prefetch" href="/mylinuxbook/assets/js/36.94ff80f2.js"><link rel="prefetch" href="/mylinuxbook/assets/js/37.8ab4fea2.js"><link rel="prefetch" href="/mylinuxbook/assets/js/38.c6108e07.js"><link rel="prefetch" href="/mylinuxbook/assets/js/39.1457bbfb.js"><link rel="prefetch" href="/mylinuxbook/assets/js/4.e378dd76.js"><link rel="prefetch" href="/mylinuxbook/assets/js/40.e1bdfd94.js"><link rel="prefetch" href="/mylinuxbook/assets/js/41.66465ce3.js"><link rel="prefetch" href="/mylinuxbook/assets/js/42.b89cf0de.js"><link rel="prefetch" href="/mylinuxbook/assets/js/43.f94e4875.js"><link rel="prefetch" href="/mylinuxbook/assets/js/44.20bb18b5.js"><link rel="prefetch" href="/mylinuxbook/assets/js/45.801523e5.js"><link rel="prefetch" href="/mylinuxbook/assets/js/46.f433d4b9.js"><link rel="prefetch" href="/mylinuxbook/assets/js/47.8affa365.js"><link rel="prefetch" href="/mylinuxbook/assets/js/48.72d455b2.js"><link rel="prefetch" href="/mylinuxbook/assets/js/49.c50686a8.js"><link rel="prefetch" href="/mylinuxbook/assets/js/5.78636818.js"><link rel="prefetch" href="/mylinuxbook/assets/js/50.cb3b550f.js"><link rel="prefetch" href="/mylinuxbook/assets/js/52.7e2b9374.js"><link rel="prefetch" href="/mylinuxbook/assets/js/53.3674e134.js"><link rel="prefetch" href="/mylinuxbook/assets/js/54.afd91567.js"><link rel="prefetch" href="/mylinuxbook/assets/js/55.c78bed3b.js"><link rel="prefetch" href="/mylinuxbook/assets/js/56.035f0150.js"><link rel="prefetch" href="/mylinuxbook/assets/js/57.b1b0bca2.js"><link rel="prefetch" href="/mylinuxbook/assets/js/58.e1f90db2.js"><link rel="prefetch" href="/mylinuxbook/assets/js/59.07c30f18.js"><link rel="prefetch" href="/mylinuxbook/assets/js/6.05d48268.js"><link rel="prefetch" href="/mylinuxbook/assets/js/60.0f4d3030.js"><link rel="prefetch" href="/mylinuxbook/assets/js/61.7fe51358.js"><link rel="prefetch" href="/mylinuxbook/assets/js/62.4b8a6bf3.js"><link rel="prefetch" href="/mylinuxbook/assets/js/63.f02ded6c.js"><link rel="prefetch" href="/mylinuxbook/assets/js/64.d5738a5d.js"><link rel="prefetch" href="/mylinuxbook/assets/js/8.9126a2d6.js"><link rel="prefetch" href="/mylinuxbook/assets/js/9.944e3509.js"><link rel="prefetch" href="/mylinuxbook/assets/js/vendors~docsearch.d9fedd68.js">
    <link rel="stylesheet" href="/mylinuxbook/assets/css/0.styles.47dc1b2a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Linux 学习笔记</h3> <p class="description" data-v-59e6cb88>Linux 学习笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mylinuxbook/" class="home-link router-link-active"><!----> <span class="site-name">Linux 学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mylinuxbook/" class="nav-link"><i class="undefined"></i>
  Home
</a></div> <a href="https://github.com/Lqinggang" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>27</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/mylinuxbook/" class="nav-link"><i class="undefined"></i>
  Home
</a></div> <a href="https://github.com/Lqinggang" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><a href="/mylinuxbook/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设备驱动</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mylinuxbook/driver/" aria-current="page" class="sidebar-link">Linux 设备驱动</a></li><li><a href="/mylinuxbook/driver/model.html" class="sidebar-link">Linux 设备模型</a></li><li><a href="/mylinuxbook/driver/modules/modules.html" aria-current="page" class="active sidebar-link">Linux 设备驱动相关组件</a></li><li><a href="/mylinuxbook/driver/devicetree.html" class="sidebar-link">Linux 设备树</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>platform 设备</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>字符设备</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>I2C 设备</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>SPI 设备</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>虚拟文件系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络通信</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进程/线程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>同步</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中断和异常</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>定时器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>示例</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/mylinuxbook/reference.html" class="sidebar-link">参考文献</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">Linux 设备驱动相关组件</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="linux-设备驱动相关组件"><a href="#linux-设备驱动相关组件" class="header-anchor">#</a> Linux 设备驱动相关组件</h1> <h2 id="kobject-对象"><a href="#kobject-对象" class="header-anchor">#</a> kobject 对象</h2> <h3 id="kobject-基础知识"><a href="#kobject-基础知识" class="header-anchor">#</a> kobject 基础知识</h3> <div id="kobject"></div>
kobject 是组成设备模型的基本结构, 最初可以理解为一个简单的计数器，但现在 kobject 能处理的任务和支持的代码已经不仅仅是作为计数器
<p>当前 kobject 结构所能处理的任务和它支持的代码:</p> <ol><li>对象的引用计数器</li></ol> <p>当内核对象被创建时, 通过使用引用计数器来跟踪对象生命周期, 在没有代码持有该对象的引用时, 该对象结束自己的有效生命周期, 并且可以删除</p> <ol start="2"><li>sysfs 表述</li></ol> <p>在 <a href="/mylinuxbook/fs/specialfs.html#sysfs">sysfs 文件系统</a>中显示的每一个对象, 都对应一个 kobject, 它被用来与内核交互并创建它的可见表述</p> <ol start="3"><li>数据结构关联</li></ol> <p>设备模型是一个友好而复杂的数据结构, 通过在其间的大量连接而构成一个多层次的体系结构, kobject 实现了该结构并把它们聚合在一起</p> <ol start="4"><li>热插拔事件处理</li></ol> <p>当系统中的硬件被热插拔时, 在 kobject 子系统控制下, 将产生事件以通知用户空间</p> <h3 id="kset-对象"><a href="#kset-对象" class="header-anchor">#</a> kset 对象</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/**
 * struct kset - a set of kobjects of a specific type, belonging to a specific subsystem.
 *
 * A kset defines a group of kobjects.  They can be individually
 * different &quot;types&quot; but overall these kobjects all want to be grouped
 * together and operated on in the same manner.  ksets are used to
 * define the attribute callbacks and other common events that happen to
 * a kobject.
 *
 * @list: the list of all kobjects for this kset
 * @list_lock: a lock for iterating over the kobjects
 * @kobj: the embedded kobject for this kset (recursion, isn't it fun...)
 * @uevent_ops: the set of uevent operations for this kset.  These are
 * called whenever a kobject has something happen to it so that the kset
 * can add new environment variables, or filter out the uevents if so
 * desired.
 */</span>
<span class="token keyword">struct</span> <span class="token class-name">kset</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">list_head</span> list<span class="token punctuation">;</span>
    <span class="token class-name">spinlock_t</span> list_lock<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kobject</span> kobj<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">kset_uevent_ops</span> <span class="token operator">*</span>uevent_ops<span class="token punctuation">;</span>
<span class="token punctuation">}</span> __randomize_layout<span class="token punctuation">;</span>
</code></pre></div><h3 id="kobject-对象-2"><a href="#kobject-对象-2" class="header-anchor">#</a> kobject 对象</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>      <span class="token operator">*</span>name<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">list_head</span>    entry<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kobject</span>      <span class="token operator">*</span>parent<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kset</span>     <span class="token operator">*</span>kset<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kobj_type</span>    <span class="token operator">*</span>ktype<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kernfs_node</span>  <span class="token operator">*</span>sd<span class="token punctuation">;</span> <span class="token comment">/* sysfs directory entry */</span>
    <span class="token keyword">struct</span> <span class="token class-name">kref</span>     kref<span class="token punctuation">;</span>
##ifdef CONFIG_DEBUG_KOBJECT_RELEASE
    <span class="token keyword">struct</span> <span class="token class-name">delayed_work</span> release<span class="token punctuation">;</span>
##endif
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> state_initialized<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> state_in_sysfs<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> state_add_uevent_sent<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> state_remove_uevent_sent<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> uevent_suppress<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="kobject-初始化"><a href="#kobject-初始化" class="header-anchor">#</a> kobject 初始化</h3> <ol><li>对 kobject 清零</li></ol> <p>通常调用 memset 函数设置为 0, 如果忘记对 kobject 的清零初始化, 则在以后使用 kobject 时, 可能会发生一些奇怪的错误(因为此时 kobject 对象可能是随机数据, 里面涉及到的诸如引用计数的值会不正确)</p> <ol start="2"><li>调用 kobject_init() 函数初始设置结构内部的一些成员</li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">kobject_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span>kobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里, 引用设置引用计数为1</p> <h3 id="对引用计数的操作"><a href="#对引用计数的操作" class="header-anchor">#</a> 对引用计数的操作</h3> <p>kobject 的一个重要作用是作为引用计数, 可以通过如下函数设置应用计数器的值</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span><span class="token function">kobject_get</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span>kobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数用于增加 kobject 的引用计数, 调用成功, 则增加 kobject 的引用计数, 并返回指向 kobject 的指针, 否则返回 NULL, 必须检查返回值, 否则可能会产生麻烦的竞态</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">kobject_put</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span>kobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数用于减少 kobject 的引用计数, 调用成功, 则减少 kobject 的引用计数, 并在可能的情况下释放该对象, kobject_init() 函数初始化时, 将 kobject 的引用计数设置为1, 所以至少需要调用一次 kobject_put 来释放该 kobject 对象</p> <h3 id="kobject-的释放"><a href="#kobject-的释放" class="header-anchor">#</a> kobject 的释放</h3> <p>kobject 的引用计数变为0是不可预知的, 则释放 kobject 的时间也是不可预知的, 为了解决这个问题， 当 kobject 的最后一个引用计数不再存在的时候, 必须通过使用 kobject 的 release 方法异步地通知要释放 kobject</p> <p>每个 kobject 都必须有一个 release 方法, 并且 kobject 在该方法被调用前必须保持不变</p> <p>release 方法并不包含在 kobject 自身内(不然释放的时候就不正确), kobject 包含在称为 ktype 的 kobj_type 数据结构中, 每个 kobject 都需要一个相应的 kobj_type 结构</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">kobj_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>relese<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sysfs_ops</span> <span class="token operator">*</span>sysfs_ops<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">attribute</span> <span class="token operator">*</span>default_attrs<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在 kobject 结构中, ktype 成员变量保存 kobj_type 的指针， 对于 kset 数据结构, 可以通过</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">kobj_type</span> <span class="token operator">*</span><span class="token function">get_ktype</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">kobject</span> <span class="token operator">*</span>kobj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>函数查找指定 kobject 对应的 kobj_type 指针</p> <div id="bus_type"></div> <h2 id="linux-总线对象"><a href="#linux-总线对象" class="header-anchor">#</a> Linux 总线对象</h2> <p>为了确保计算机能够正常工作, 必须提供数据通路, 让信息在连接到个人计算机的CPU、RAM和I/O设备之间流动，这些数据通路总称为总线</p> <p>所有计算机都拥有一条系统总线，它连接大部分内部硬件设备, 在<a href="/mylinuxbook/driver/model.html">Linux 设备模型</a>中所有的设备都通过总线相连</p> <p>总线将设备和驱动绑定, 系统每注册一个设备的时候, 会寻找与之匹配的驱动, 相反的, 系统每注册一个驱动的时候，会需找与之匹配而的设备, 而这里的匹配就是由总线完成的</p> <h3 id="总线对象"><a href="#总线对象" class="header-anchor">#</a> 总线对象</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>      <span class="token operator">*</span>name<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>      <span class="token operator">*</span>dev_name<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">device</span>       <span class="token operator">*</span>dev_root<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>bus_groups<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>dev_groups<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>drv_groups<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>match<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>drv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>uevent<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">kobj_uevent_env</span> <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>probe<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sync_state<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>remove<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>shutdown<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>online<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>offline<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>suspend<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token class-name">pm_message_t</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>resume<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>num_vf<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>dma_configure<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">dev_pm_ops</span> <span class="token operator">*</span>pm<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">iommu_ops</span> <span class="token operator">*</span>iommu_ops<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">subsys_private</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">lock_class_key</span> lock_key<span class="token punctuation">;</span>

    bool need_parent_lock<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>总线类型名称</td></tr> <tr><td>match</td> <td>检验给定的设备驱动程序是否支持特有设备的方法, 当一总线上的新设备或者新驱动被添加时, 会一次或多次调用这个函数, 当指定的驱动程序能够处理指定设备时, 返回非零值</td></tr> <tr><td>hotplug</td> <td>在用户空间产生热插拔事件前, 这个方法运行总线添加环境变量, 其参数与 kset 的 kotplug 方法相同</td></tr></tbody></table> <h3 id="总线注册与删除"><a href="#总线注册与删除" class="header-anchor">#</a> 总线注册与删除</h3> <p>对于新的总线, 必须调用 bus_register 进行注册, 注册成功后, 在/sys/bus/目录下将看到注册之后的总线, 之后即可向这个总线添加设备</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">bus_register</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> ldd_bus_type <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;ldd&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>match <span class="token operator">=</span> ldd_match<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>hotplug <span class="token operator">=</span> ldd_hotplug<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ret <span class="token operator">=</span> <span class="token function">bus_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ldd_bus_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>当需要删除一个总线的时候, 可以通过 bus_unregister 函数删除</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">bus_unregister</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总线属性"><a href="#总线属性" class="header-anchor">#</a> 总线属性</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">bus_attribute</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">attribute</span>    attr<span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>show<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>store<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div id="class"></div> <h2 id="linux-类对象"><a href="#linux-类对象" class="header-anchor">#</a> Linux 类对象</h2> <p>类是一个设备的高层视图, 它抽象了底层的实现细节, 几乎所有的类对象都属于与 /sys/class 目录相对应的 class_subsys 子系统</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">class</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>      <span class="token operator">*</span>name<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">module</span>       <span class="token operator">*</span>owner<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span>    <span class="token operator">*</span><span class="token operator">*</span>class_groups<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span>    <span class="token operator">*</span><span class="token operator">*</span>dev_groups<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">kobject</span>          <span class="token operator">*</span>dev_kobj<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>dev_uevent<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">kobj_uevent_env</span> <span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>devnode<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token class-name">umode_t</span> <span class="token operator">*</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>class_release<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">class</span> <span class="token operator">*</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>dev_release<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>shutdown_pre<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">kobj_ns_type_operations</span> <span class="token operator">*</span>ns_type<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>namespace<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>get_ownership<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token class-name">kuid_t</span> <span class="token operator">*</span>uid<span class="token punctuation">,</span> <span class="token class-name">kgid_t</span> <span class="token operator">*</span>gid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">dev_pm_ops</span> <span class="token operator">*</span>pm<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">subsys_private</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="类对象的注册和销毁"><a href="#类对象的注册和销毁" class="header-anchor">#</a> 类对象的注册和销毁</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">class_register</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">class</span> <span class="token operator">*</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">class_unregister</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">class</span> <span class="token operator">*</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div id="device"></div> <h2 id="linux-设备对象"><a href="#linux-设备对象" class="header-anchor">#</a> Linux 设备对象</h2> <p>设备对象全部收集在 devices_subsys 子系统中, 该子系统对应的目录为 /sys/devices， 一个设备是某个&quot;孩子&quot;的&quot;父亲&quot;, 其条件为子设备离开父设备无法正常工作</p> <h3 id="设备对象"><a href="#设备对象" class="header-anchor">#</a> 设备对象</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">kobject</span> kobj<span class="token punctuation">;</span>  <span class="token comment">/* 计数器 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>parent<span class="token punctuation">;</span> <span class="token comment">/*  父设备 */</span>

    <span class="token keyword">struct</span> <span class="token class-name">device_private</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>init_name<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">;</span> <span class="token comment">/* 这个设备所连接的总线 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>driver<span class="token punctuation">;</span> <span class="token comment">/* 这个设备对应的驱动程序 */</span>

    <span class="token keyword">void</span> <span class="token operator">*</span>driver_data<span class="token punctuation">;</span> <span class="token comment">/* 设备驱动程序私有数据 */</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>platform_data<span class="token punctuation">;</span> <span class="token comment">/* 遗留设备驱动程序的私有数据 */</span>

##ifdef CONFIG_PROVE_LOCKING
    <span class="token keyword">struct</span> <span class="token class-name">mutex</span> lockdep_mutext<span class="token punctuation">;</span>
##endif
    <span class="token keyword">struct</span> <span class="token class-name">mutex</span> mutext<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">dev_links_info</span> links<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">dev_pm_info</span> power<span class="token punctuation">;</span> <span class="token comment">/* 电源管理信息 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">dev_pm_domain</span> <span class="token operator">*</span>pm_domain<span class="token punctuation">;</span>

##ifdef CONFIG_ENERGY_MODEL
    <span class="token keyword">struct</span> <span class="token class-name">em_perf_domain</span> <span class="token operator">*</span>em_pd<span class="token punctuation">;</span>
##endif

##ifdef CONFIG_GENERIC_MSI_IRQ_DOMAIN
    <span class="token keyword">struct</span> <span class="token class-name">irq_domain</span> <span class="token operator">*</span>msi_domain<span class="token punctuation">;</span>
##endif
##ifdef CONFIG_PRINCTRL
    <span class="token keyword">struct</span> <span class="token class-name">dev_pin_info</span> <span class="token operator">*</span>pins<span class="token punctuation">;</span>
##endif
##ifdef CONFIG_GENERIC_MSI_IRQ
    <span class="token keyword">struct</span> <span class="token class-name">list_head</span> msi_list<span class="token punctuation">;</span>
##endif
##ifdef CONFIG_DMA_OPS
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">dma_map_ops</span> <span class="token operator">*</span>dma_ops<span class="token punctuation">;</span>
##endif
    u64 <span class="token operator">*</span>dma_mask<span class="token punctuation">;</span>  <span class="token comment">/* 设备的DMA屏蔽字 */</span>
    u64 coherent_dma_msk<span class="token punctuation">;</span> <span class="token comment">/* 设备的一致性DMA的屏蔽字 */</span>
    u64 bus_dma_list<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">bus_dma_region</span> <span class="token operator">*</span>dma_range_map<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">device_dma_parameters</span> <span class="token operator">*</span>dma_parms<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">list_head</span> dma_pools<span class="token punctuation">;</span> <span class="token comment">/* 聚集的DMA缓冲池链表的首部 */</span>

##ifdef CONFIG_DMA_DECLARE_COHERENT
    <span class="token keyword">struct</span> <span class="token class-name">dma_coherent_mem</span> <span class="token operator">*</span>dma_mem<span class="token punctuation">;</span> <span class="token comment">/* 设备所使用的一致性DMA存储器描述符 */</span>
##endif

##ifdef CONFIG_DMA_CMA
    <span class="token keyword">struct</span> <span class="token class-name">cma</span> <span class="token operator">*</span>cma_area<span class="token punctuation">;</span>
##endif
    <span class="token keyword">struct</span> <span class="token class-name">dev_archdata</span> archdata<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">device_node</span> <span class="token operator">*</span>of_node<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">fwnode_handle</span> <span class="token operator">*</span>fwnode<span class="token punctuation">;</span>

##ifdef CONFIG_NUMA
    <span class="token keyword">int</span> numa_node<span class="token punctuation">;</span>
##endif
    <span class="token class-name">dev_t</span> devt<span class="token punctuation">;</span>
    u32 id<span class="token punctuation">;</span>
    <span class="token class-name">spinlock_t</span> devres_lock<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">list_head</span> devres_head<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">class</span> <span class="token operator">*</span>class<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>groups<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>release<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span>  <span class="token class-name">devie</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 释放设备描述符的回调函数 */</span>

    <span class="token keyword">struct</span> <span class="token class-name">iommu_group</span> <span class="token operator">*</span>iommu_group<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">dev_iommu</span> <span class="token operator">*</span>iommu<span class="token punctuation">;</span>

    bool offline_disabled<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    bool offline<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    bool of_node_reused<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
    bool state_synced<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
##<span class="token keyword">if</span> <span class="token function">defined</span><span class="token punctuation">(</span>CONFIG_ARCH_HAS_SYNC_DMA_FOR_DEICE<span class="token punctuation">)</span> <span class="token operator">||</span> \
    <span class="token function">defined</span><span class="token punctuation">(</span>CONFIG_ARCH_HAS_SYNC_DMA_FOR_CPU<span class="token punctuation">)</span> <span class="token operator">||</span> \
    <span class="token function">defined</span><span class="token punctuation">(</span>CONFIG_ARCH_HAS_SYNC_DMA_FOR_CPU_ALL<span class="token punctuation">)</span> <span class="token operator">||</span>
    bool dma_coherent<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
##endif
ifdef CONFIG_DMA_OPS_BYPASS
    bool dma_ops_bypass<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
##endif
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>parent</td> <td>设备的&quot;父&quot;设备 ---- 指的是该设备所属的设备, 通常是某种总线或宿主控制器, 为NULL, 表示该设备是顶层设备</td></tr> <tr><td>kobj</td> <td>表示该设备并把它连接到结构体系中的 kobject</td></tr> <tr><td>bus</td> <td>标识了该设备连接在何种类型的总线上</td></tr> <tr><td>driver</td> <td>管理该设备的驱动程序</td></tr> <tr><td>driver_data</td> <td>有设备驱动程序使用的私有数据成员</td></tr> <tr><td>release</td> <td>当指向设备的最有一个引用被删除时，内核调用该方法, 又内嵌的 kobject 的 release 方法调用</td></tr></tbody></table> <h3 id="设备注册和销毁"><a href="#设备注册和销毁" class="header-anchor">#</a> 设备注册和销毁</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">device_register</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">device_unregister</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上, 一般通过 device_register 和 device_unregister 函数对设备分别进行注册和销毁, 即<strong>往设备驱动模型中插入一个新的 device 对象, 并自动地在 /sys/devices 目录下为其创建一个新的目录, 或者将设备从设备驱动模型中移除</strong></p> <p>示例:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ldd_bus_release</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printk</span><span class="token punctuation">(</span>KERN_DEBUG <span class="token string">&quot;lddbus release\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">device</span> ldd_Bus <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span>bus_id <span class="token operator">=</span> <span class="token string">&quot;ldd0&quot;</span><span class="token punctuation">,</span>  <span class="token comment">/* 这里的代码是基于 Linux 2.6 版本, 所以 device 结构体中有 bus_id 成员 */</span>
    <span class="token punctuation">.</span>release <span class="token operator">=</span> ldd_bus_release
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ret <span class="token operator">=</span> <span class="token function">device_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ldd_bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printk</span><span class="token punctuation">(</span>KERN_NOTICE <span class="token string">&quot; Unable to register ldd0\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一般来说，大多数子系统记录了它们所拥有设备的其他信息, 设备结构并不单独使用, 而是嵌入到高层的设备结构体中, 即将 struct device 设备对象结构体内嵌到具体的设备中, 如I2C, PCI, USB等设备, struct device 作为这些具体设备的一个成员变量, 有点类似于基类</p> <p>示例:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">ldd_device</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">ldd_driver</span> <span class="token operator">*</span>driver<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">device</span> dev<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

##define <span class="token function">to_ldd_device</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span> <span class="token function">container_of</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">ldd_device</span><span class="token punctuation">,</span> dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所以在这种情况下, 设备的注册会将会如下:</p> <div class="language-c extra-class"><pre class="language-c"><code>ret <span class="token operator">=</span> <span class="token function">device_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ldd_device<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当需要的时候, 可以调用 container_of 获取包含 struct device 设备对象的具体设备的结构体, 从而获取到具体设备的其他信息, 如上<code>to_ldd_device</code>宏, 就可以根据 struct device 设备对象获取到 ldd_device 对象的 name 字段的值</p> <h3 id="设备属性"><a href="#设备属性" class="header-anchor">#</a> 设备属性</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* interface for exporting device attributes */</span>
<span class="token keyword">struct</span> <span class="token class-name">device_attribute</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">attribute</span>    attr<span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>show<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">device_attribute</span> <span class="token operator">*</span>attr<span class="token punctuation">,</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>store<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">device_attribute</span> <span class="token operator">*</span>attr<span class="token punctuation">,</span>
             <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="对设备的迭代"><a href="#对设备的迭代" class="header-anchor">#</a> 对设备的迭代</h3> <p>为了操作注册到某个总线上的每个设备，可以通过 <code>bus_for_each_dev</code> 函数进行迭代</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">bus_for_each_dev</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>start<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数将迭代总线 bus 上的每个设备, start 不为 NULL 的情况下, 从 bus 上 start 位置开始的设备开始迭代, 否则从 bus 上的第一个设备开始迭代, 迭代的每个设备以及 data 将作为 fn 的参数，fn 返回非 0 时, 迭代结束， bus_for_each_dev 返回该值</p> <div id="device_driver"></div> <h2 id="linux-驱动程序对象"><a href="#linux-驱动程序对象" class="header-anchor">#</a> Linux 驱动程序对象</h2> <p>设备驱动模型跟踪所有系统所知道的设备, 进行跟踪的主要原因是让驱动程序核心协调驱动程序于新设备之间的关系</p> <h3 id="驱动程序对象"><a href="#驱动程序对象" class="header-anchor">#</a> 驱动程序对象</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span> <span class="token comment">/* 设备驱动程序的名称 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">;</span> <span class="token comment">/* 总线描述符, 总线连接所支持的设备 */</span>

    <span class="token keyword">struct</span> <span class="token class-name">module</span> <span class="token operator">*</span>owner<span class="token punctuation">;</span>   <span class="token comment">/* 标识实现驱动程序的模块 */</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode_name<span class="token punctuation">;</span>

    bool suppress_bind_attrs<span class="token punctuation">;</span>
    <span class="token keyword">enum</span> <span class="token class-name">probe_type</span> probe_type<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">of_device_id</span> <span class="token operator">*</span>of_match_table<span class="token punctuation">;</span>  <span class="token comment">/* 设备树节点兼容性匹配表 */</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">acpi_device_id</span> <span class="token operator">*</span>acpi_match_table<span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>probe<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 探测设备的方法 */</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sync_state<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>remove<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">deivce</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 移除设备时所调用的方法 */</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>shutdown<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">devie</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 设备断电时所调用的方法 */</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>suspend<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token class-name">pm_message_t</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 设备置于低功耗状态时调用的方法 */</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>resume<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 设备回复正常状态时调用的方法 */</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>groups<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">attribute_group</span> <span class="token operator">*</span><span class="token operator">*</span>dev_groups<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">dev_pm_ops</span> <span class="token operator">*</span>pm<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>coredump<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">driver_private</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>驱动程序的名字, 它将在 <a href="/mylinuxbook/fs/specialfs.html#sysfs">sysfs 文件系统</a> 中显示</td></tr> <tr><td>kobj</td> <td>表示该驱动程序并把它连接到结构体系中的 kobject</td></tr> <tr><td>bus</td> <td>标识了该驱动程序所操作的的总线类型</td></tr> <tr><td>probe</td> <td>用来查询特定设备是否存在以及这个驱动程序是否能够操纵它</td></tr> <tr><td>remove</td> <td>设备从系统中删除的时候调用</td></tr> <tr><td>shutdown</td> <td>关机的时候用于关闭设备</td></tr></tbody></table> <h3 id="驱动程序的注销和销毁"><a href="#驱动程序的注销和销毁" class="header-anchor">#</a> 驱动程序的注销和销毁</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">driver_register</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>drv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">driver_unregister</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>drv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上, 一般通过 driver_register 和 driver_unregister 函数对驱动程序对象分别进行注册和销毁, 即<strong>往设备驱动模型中插入一个新的 driver 对象, 并自动地在 /sys/drivers 目录下为其创建一个新的目录, 或者将驱动程序对象从设备驱动模型中移除</strong></p> <p>和<a href="#device">设备对象</a>类似, 驱动程序对象往往也会嵌入到更大的具体的驱动程序描述符中</p> <p>示例:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">ldd_driver</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>version<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">module</span> <span class="token operator">*</span>module<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">device_driver</span> driver<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">driver_attribute</span> version_attr<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="驱动程序的属性"><a href="#驱动程序的属性" class="header-anchor">#</a> 驱动程序的属性</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* sysfs interface for exporting driver attributes */</span>

<span class="token keyword">struct</span> <span class="token class-name">driver_attribute</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">attribute</span> attr<span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>show<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>driver<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> <span class="token punctuation">(</span><span class="token operator">*</span>store<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>driver<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span>
             <span class="token class-name">size_t</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="对驱动程序对象的迭代"><a href="#对驱动程序对象的迭代" class="header-anchor">#</a> 对驱动程序对象的迭代</h3> <p>为了操作注册到某个总线上的每个驱动程序对象，可以通过 <code>bus_for_each_drv</code> 函数进行迭代</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">bus_for_each_dev</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">bus_type</span> <span class="token operator">*</span>bus<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span>start<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device_driver</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数将迭代总线 bus 上的每个驱动程序对象, start 不为 NULL 的情况下, 从 bus 上 start 位置开始的驱动程序对象开始迭代, 否则从 bus 上的第一个驱动程序对象开始迭代, 迭代的每个驱动程序对象以及 data 将作为 fn 的参数，fn 返回非 0 时, 迭代结束， bus_for_each_drv 返回该值</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mylinuxbook/driver/model.html" class="prev">
          Linux 设备模型
        </a></span> <span class="next"><a href="/mylinuxbook/driver/devicetree.html">
          Linux 设备树
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----></div></div>
    <script src="/mylinuxbook/assets/js/app.4ad5f28c.js" defer></script><script src="/mylinuxbook/assets/js/7.c4013074.js" defer></script><script src="/mylinuxbook/assets/js/2.da4ee029.js" defer></script><script src="/mylinuxbook/assets/js/1.8f7de685.js" defer></script><script src="/mylinuxbook/assets/js/51.6a62369f.js" defer></script>
  </body>
</html>
